{
  "cveId": "CVE-2024-56515",
  "title": "Untrusted file formats can be thumbnailed, invoking potentially further untrusted decoders in Matrix Media Repo",
  "description": "Matrix Media Repo (MMR) is a highly configurable multi-homeserver media repository for Matrix. If SVG or JPEGXL thumbnailers are enabled (they are disabled by default), a user may upload a file which claims to be either of these types and request a thumbnail to invoke a different decoder in ImageMagick. In some ImageMagick installations, this includes the capability to run Ghostscript to decode the image/file. If MP4 thumbnailers are enabled (also disabled by default), the same issue as above may occur with the ffmpeg installation instead. MMR uses a number of other decoders for all other file types when preparing thumbnails. Theoretical issues are possible with these decoders, however in testing they were not possible to exploit. This is fixed in MMR v1.3.8. MMR now inspects the mimetype of media prior to thumbnailing, and picks a thumbnailer based on those results instead of relying on user-supplied values. This may lead to fewer thumbnails when obscure file shapes are used. This also helps narrow scope of theoretical issues with all decoders MMR uses for thumbnails. Users are advised to upgrade. Users unable to upgrade may disable the SVG, JPEGXL, and MP4 thumbnail types in the MMR config which prevents the decoders from being invoked. Further disabling uncommon file types on the server is recommended to limit risk surface. Containers and other similar technologies may also be used to limit the impact of vulnerabilities in external decoders, like ImageMagick and ffmpeg. Some installations of ImageMagick may disable \"unsafe\" file types, like PDFs, already. This option can be replicated to other environments as needed. ffmpeg may be compiled with limited decoders/codecs. The Docker image for MMR disables PDFs and similar formats by default.",
  "publishedDate": "2025-01-16T19:11:02.868000+00:00",
  "lastModifiedDate": "2025-02-12T20:31:21.997000+00:00",
  "severity": "MEDIUM",
  "cvssMetrics": [
    {
      "version": "3.1",
      "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:N/A:N",
      "baseScore": 6.8,
      "baseSeverity": "MEDIUM"
    }
  ],
  "epss": {
    "score": 0.0007,
    "percentile": 22.908
  },
  "riskScore": 38,
  "exploitationStatus": "UNKNOWN",
  "affectedSystems": {
    "cpeMatches": [],
    "vendors": ["t2bot"],
    "products": ["matrix-media-repo"]
  },
  "references": [
    {
      "url": "https://github.com/t2bot/matrix-media-repo/security/advisories/GHSA-rcxc-wjgw-579r",
      "source": "https://github.com/t2bot/matrix-media-repo/security/advisories/GHSA-rcxc-wjgw-579r",
      "tags": ["x_refsource_CONFIRM"]
    },
    {
      "url": "https://github.com/t2bot/matrix-media-repo/releases/tag/v1.3.8",
      "source": "https://github.com/t2bot/matrix-media-repo/releases/tag/v1.3.8",
      "tags": ["x_refsource_MISC"]
    }
  ],
  "attackTechniques": [],
  "metadata": {
    "tags": ["CWE-502"],
    "requiresUserInteraction": null,
    "requiresPrivileges": null,
    "attackVector": null,
    "sources": [
      {
        "name": "CVEList",
        "url": "https://github.com/CVEProject/cvelistV5/blob/main/cves/2024/56xxx/CVE-2024-56515.json",
        "lastModified": "2025-02-12T20:31:21.997000+00:00"
      }
    ]
  }
}
